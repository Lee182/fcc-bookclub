// Generated by CoffeeScript 2.0.1
var app, body_parser_json, bookapi, cookie_parser, dao, port, server, tw, ws;

import http from 'http';

import path from 'path';

import express from 'express';

import bodyParser from 'body-parser';

import cookieParser from 'cookie-parser';

import express_user from 'server/express/user.coffee';

import express_book from 'server/express/book.coffee';

import ws_handle from 'server/ws/index.coffee';

import k from 'server/keys.coffee';

import db from 'server/db.coffee';

app = express();

server = http.Server(app);

port = process.argv[2] || 3000;

cookie_parser = cookieParser();

body_parser_json = bodyParser.json();

dao = new db({
  mongourl: k.mongourl
});

app.use(cookie_parser);

app.use(body_parser_json);

app.use('/', express.static(path.resolve(__dirname + '/dist')));

tw = express_user({ app, port, dao, k, 'bookclub_sessions': 'bookclub_sessions' });

bookapi = express_book({ app, dao });

ws = ws_handle({ app, server, cookie_parser, tw, dao });

app.get('*', function (req, res) {
  return res.sendFile(path.resolve(__dirname + '/dist/index.html'));
});

dao.connect().then(function () {
  return server.listen(port, function () {
    return console.log('server listening at http://localhost:' + port);
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiLi4iLCJzb3VyY2VzIjpbInNlcnZlci9pbmRleC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLElBQUE7O0FBQUEsT0FBQSxBQUFPLFVBQVA7O0FBQ0EsT0FBQSxBQUFPLFVBQVA7O0FBQ0EsT0FBQSxBQUFPLGFBQVA7O0FBQ0EsT0FBQSxBQUFPLGdCQUFQOztBQUNBLE9BQUEsQUFBTyxrQkFBUDs7QUFDQSxPQUFBLEFBQU8sa0JBQVA7O0FBQ0EsT0FBQSxBQUFPLGtCQUFQOztBQUNBLE9BQUEsQUFBTyxlQUFQOztBQUNBLE9BQUEsQUFBTyxPQUFQOztBQUNBLE9BQUEsQUFBTyxRQUFQOztBQUVBLE1BQU07O0FBQ04sU0FBUyxBQUFJLEtBQUosQUFBSyxPQUFMLEFBQVk7O0FBQ3JCLE9BQU8sQUFBTyxRQUFDLEFBQUssS0FBYixBQUFhLE1BQU07O0FBQzFCLGdCQUFnQjs7QUFDaEIsbUJBQW1CLEFBQVUsV0FBVixBQUFXOztBQUU5QixVQUFNLEFBQUk7QUFBSyxZQUFVLEFBQUMsRUFBcEIsQUFBTyxBQUFjO0FBQWQsQ0FBUDs7QUFDTixBQUFHLElBQUgsQUFBSSxJQUFKLEFBQVE7O0FBQ1IsQUFBRyxJQUFILEFBQUksSUFBSixBQUFROztBQUNSLEFBQUcsSUFBSCxBQUFJLElBQUosQUFBUSxLQUFLLEFBQU8sUUFBUCxBQUFRLE9BQU8sQUFBSSxLQUFKLEFBQUssUUFBUSxZQUF6QyxBQUFhLEFBQWUsQUFBeUI7O0FBRXJELEtBQUssYUFBYSxFQUFBLEFBQUUsS0FBRixBQUFPLE1BQVAsQUFBYSxLQUFiLEFBQWtCLEdBQUcscUJBQWxDLEFBQWEsQUFBcUI7O0FBQ3ZDLFVBQVUsYUFBYSxFQUFBLEFBQUUsS0FBZixBQUFhLEFBQU87O0FBQzlCLEtBQUssVUFBVSxFQUFBLEFBQUUsS0FBRixBQUFPLFFBQVAsQUFBZSxlQUFmLEFBQThCLElBQXhDLEFBQVUsQUFBa0M7O0FBRWpELEFBQUcsSUFBSCxBQUFJLElBQUosQUFBUSxLQUFLLFVBQUEsQUFBQyxLQUFELEFBQU07U0FDakIsQUFBRyxJQUFILEFBQUksU0FBUyxBQUFJLEtBQUosQUFBSyxRQUFRLFlBRGYsQUFDWCxBQUFhLEFBQXlCO0FBRHhDOztBQUdBLEFBQUcsSUFBSCxBQUFJLEFBQVMsVUFBYixBQUFjLEtBQUs7Z0JBQ2pCLEFBQU8sT0FBUCxBQUFjLE1BQU07V0FDbEIsQUFBTyxRQUFQLEFBQVEsSUFBSSwwQ0FETSxBQUNsQixBQUFzRDtBQUZ2QyxBQUNqQixHQUFBLEFBQU07QUFEUiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBodHRwICBmcm9tICdodHRwJ1xuaW1wb3J0IHBhdGggIGZyb20gJ3BhdGgnXG5pbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJ1xuaW1wb3J0IGJvZHlQYXJzZXIgZnJvbSAnYm9keS1wYXJzZXInXG5pbXBvcnQgY29va2llUGFyc2VyIGZyb20gJ2Nvb2tpZS1wYXJzZXInXG5pbXBvcnQgZXhwcmVzc191c2VyIGZyb20gJy4vZXhwcmVzcy91c2VyJ1xuaW1wb3J0IGV4cHJlc3NfYm9vayBmcm9tICcuL2V4cHJlc3MvYm9vaydcbmltcG9ydCB3c19oYW5kbGUgZnJvbSAnLi93cy9pbmRleCdcbmltcG9ydCBrICBmcm9tICcuL2tleXMnXG5pbXBvcnQgZGIgZnJvbSAnLi9kYidcblxuYXBwID0gZXhwcmVzcygpXG5zZXJ2ZXIgPSBodHRwLlNlcnZlcihhcHApXG5wb3J0ID0gcHJvY2Vzcy5hcmd2WzJdIG9yIDMwMDBcbmNvb2tpZV9wYXJzZXIgPSBjb29raWVQYXJzZXIoKVxuYm9keV9wYXJzZXJfanNvbiA9IGJvZHlQYXJzZXIuanNvbigpXG5cbmRhbyA9IG5ldyBkYih7IG1vbmdvdXJsOiBrLm1vbmdvdXJsIH0pXG5hcHAudXNlIGNvb2tpZV9wYXJzZXJcbmFwcC51c2UgYm9keV9wYXJzZXJfanNvblxuYXBwLnVzZSAnLycsIGV4cHJlc3Muc3RhdGljKHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUgKyAnLy4uL2Rpc3QnKSlcblxudHcgPSBleHByZXNzX3VzZXIoeyBhcHAsIHBvcnQsIGRhbywgaywgJ2Jvb2tjbHViX3Nlc3Npb25zJyB9KVxuYm9va2FwaSA9IGV4cHJlc3NfYm9vayh7IGFwcCwgZGFvIH0pXG53cyA9IHdzX2hhbmRsZSh7IGFwcCwgc2VydmVyLCBjb29raWVfcGFyc2VyLCB0dywgZGFvIH0pXG5cbmFwcC5nZXQgJyonLCAocmVxLCByZXMpIC0+XG4gIHJlcy5zZW5kRmlsZSBwYXRoLnJlc29sdmUoX19kaXJuYW1lICsgJy8uLi9kaXN0L2luZGV4Lmh0bWwnKVxuXG5kYW8uY29ubmVjdCgpLnRoZW4gLT5cbiAgc2VydmVyLmxpc3RlbiBwb3J0LCAtPlxuICAgIGNvbnNvbGUubG9nICdzZXJ2ZXIgbGlzdGVuaW5nIGF0IGh0dHA6Ly9sb2NhbGhvc3Q6JyArIHBvcnQiXX0=
//# sourceURL=/home/lee/jono/web-projects/fcc-b-bookclub/server/index.coffee